<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Fiber vs Stack</title>
    <script src="/dist/zreact.js"></script>
</head>
<body>

    <div id="app"></div>
    <script>
        const {
            useState,
            useEffect,
            createElement,
            hydrate,
            Component,
        } = zreact;
        const h = createElement;
        const dotStyle = {
            position: 'absolute',
            background: '#61dafb',
            font: 'normal 15px sans-serif',
            textAlign: 'center',
            cursor: 'pointer',
        };
        const containerStyle = {
            position: 'absolute',
            transformOrigin: '0 0',
            left: '50%',
            top: '50%',
            width: '10px',
            height: '10px',
            background: '#eee',
        };
        const targetSize = 25;
        class Dot extends Component {
            constructor() {
                super();
                this.state = { hover: false };
            }
            enter() {
                this.setState({
                    hover: true
                });
            }
            leave() {
                this.setState({
                    hover: false
                });
            }
            render() {
                var props = this.props;
                var s = props.size * 1.3;
                var style = Object.assign({}, dotStyle, {
                    width: s + 'px',
                    height: s + 'px',
                    left: (props.x) + 'px',
                    top: (props.y) + 'px',
                    borderRadius: (s / 2) + 'px',
                    lineHeight: (s) + 'px',
                    background: this.state.hover ? '#ff0' : dotStyle.background
                });
                return h("div", {style: style, onMouseEnter: () => this.enter(), onMouseLeave:() => this.leave()},
                    this.state.hover ? '*' + props.text + '*' : props.text
                )
            }
        }
        function SierpinskiTriangle({ x, y, s, children }) {
            if (s <= targetSize) {
                return h(Dot,{
                    x: x - (targetSize / 2),
                    y: y - (targetSize / 2),
                    size: targetSize,
                    text: children
                })
            // return r;
            }
            const newSize = s / 2;
            const slowDown = true;
            if (slowDown) {
                const e = performance.now() + 0.8;
                while (performance.now() < e) {
                    // Artificially long execution time.
                }
            }
            s /= 2;
            return h("div", null,
                h(SierpinskiTriangle, {x: x, y: y - (s / 2), s: s},
                    children
                ),
                h(SierpinskiTriangle, {x: x - s, y: y + (s / 2), s: s},
                    children
                ),
                h(SierpinskiTriangle, {x: x + s, y: y + (s / 2), s: s},
                    children
                )
            );
        }
        SierpinskiTriangle.shouldComponentUpdate = function(oldProps, newProps) {
            var o = oldProps;
            var n = newProps;
            return !(
                o.x === n.x &&
                o.y === n.y &&
                o.s === n.s &&
                o.children === n.children
            );
        };
        function App() {
            const t = 1;
            const scale = 1 + (t > 5 ? 10 - t : t) / 10;
            const transform = 'scaleX(' + (scale / 2.1) + ') scaleY(0.7) translateZ(0.1px)';
            return h("div", {style: containerStyle},
                h("div", null,
                    h(SierpinskiTriangle, {x: 0, y: 0, s: 1000},
                        0
                    )
                )
            )
        }
        hydrate(createElement(App), document.getElementById('app'));
    </script>
    <script src="/lib/devtools.js"></script>
</body>
</html>
